<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `WrapperApi` trait in crate `dlopen`."><meta name="keywords" content="rust, rustlang, rust-lang, WrapperApi"><title>dlopen::wrapper::WrapperApi - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings"></script><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc trait"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../dlopen/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class="location">Trait WrapperApi</p><div class="sidebar-elems"><div class="block items"><a class="sidebar-title" href="#required-methods">Required Methods</a><div class="sidebar-links"><a href="#tymethod.load">load</a></div><a class="sidebar-title" href="#foreign-impls">Implementations on Foreign Types</a><div class="sidebar-links"><a href="#impl-WrapperApi-for-Option%3CT%3E">Option&lt;T&gt;</a></div><a class="sidebar-title" href="#implementors">Implementors</a></div><p class="location"><a href="../index.html">dlopen</a>::<wbr><a href="index.html">wrapper</a></p><script>window.sidebarCurrent = {name: "WrapperApi", ty: "trait", relpath: ""};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/dlopen/wrapper/api.rs.html#82-88" title="goto source code">[src]</a></span><span class="in-band">Trait <a href="../index.html">dlopen</a>::<wbr><a href="index.html">wrapper</a>::<wbr><a class="trait" href="">WrapperApi</a></span></h1><div class="docblock type-decl hidden-by-usual-hider"><pre class="rust trait">pub trait WrapperApi <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;Self: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,&nbsp;</span>{
    unsafe fn <a href="#tymethod.load" class="fnname">load</a>(lib: &amp;<a class="struct" href="../../dlopen/raw/struct.Library.html" title="struct dlopen::raw::Library">Library</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self, <a class="enum" href="../../dlopen/enum.Error.html" title="enum dlopen::Error">Error</a>&gt;;
}</pre></div><div class="docblock"><p>Trait for defining library API.</p>
<p>This trait is intended to be used with <code>#[derive(WrapperApi)]</code> macro defined in the
<code>dlopen_derive</code> crate. It forces several restrictions on types that implement it:</p>
<ul>
<li>Only structures can implement this trait.</li>
<li>All fields need to be private.</li>
<li>Only functions, references and pointers are allowed.</li>
<li>You can't define a type using <code>type Fun =fn();</code> and use it in the structure. This is a limitation
of the Rust reflection mechanism. Only raw functions, references and pointers are allowed.</li>
<li>All arguments of functions need to be named.</li>
</ul>
<p>The <code>derive</code> macro not only generates implementation of <code>load()</code> function, but it also generates
safe wrappers around the loaded symbols. These wrappers are named exactly like the field that
they wrap. Wrappers of functions have the same arguments like original functions and wrappers of
references are just simple accessors in the form of <code>&lt;field_name&gt;(&amp;self) -&gt; &amp;FieldType</code> or
<code>&lt;field_name&gt;_mut(&amp;mut self) -&gt; &amp;mut FieldType</code>.
Wrappers are not generated only for:</p>
<ul>
<li>Pointers - there is no safe way of preventing dangling symbols if a user has a direct access to
pointers. The recommended approach here is to either use references instead of pointers or
to manually create safe wrappers. For example C <code>const char *</code> can be manually converted into
<code>&amp; std::ffi::CStr</code>.</li>
<li>Variadic functions. Rust doesn't have any mechanism that allows creating safe wrappers around
them. You need to handle them manually.</li>
</ul>
<p>#Example</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="attribute">#[<span class="ident">macro_use</span>]</span>
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">dlopen_derive</span>;
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">dlopen</span>;
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">libc</span>;
<span class="kw">use</span> <span class="ident">dlopen</span>::<span class="ident">wrapper</span>::{<span class="ident">WrapperApi</span>, <span class="ident">Container</span>};
<span class="kw">use</span> <span class="ident">libc</span>::{<span class="ident">c_char</span>};
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">ffi</span>::<span class="ident">CStr</span>;

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">WrapperApi</span>)]</span>
<span class="kw">struct</span> <span class="ident">Example</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">dlopen_name</span><span class="op">=</span><span class="string">&quot;function&quot;</span>]</span>
    <span class="ident">do_something</span>: <span class="kw">extern</span> <span class="string">&quot;C&quot;</span> <span class="kw">fn</span>(),
    <span class="ident">add_one</span>: <span class="kw">unsafe</span> <span class="kw">extern</span> <span class="string">&quot;C&quot;</span> <span class="kw">fn</span> (<span class="ident">arg</span>: <span class="ident">i32</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">i32</span>,
    <span class="ident">global_count</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a</span> <span class="kw-2">mut</span> <span class="ident">u32</span>,
    <span class="ident">c_string</span>: <span class="op">*</span> <span class="kw">const</span> <span class="ident">c_char</span>,
    <span class="attribute">#[<span class="ident">dlopen_allow_null</span>]</span>
    <span class="ident">maybe_null_ptr</span>: <span class="op">*</span> <span class="kw">const</span> (),
}

<span class="comment">//wrapper for c_string won&#39;t be generated, implement it here</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">Example</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">c_string</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">CStr</span> {
        <span class="kw">unsafe</span> {<span class="ident">CStr</span>::<span class="ident">from_ptr</span>(<span class="self">self</span>.<span class="ident">c_string</span>)}
    }
}

<span class="kw">fn</span> <span class="ident">main</span> () {
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">cont</span>: <span class="ident">Container</span><span class="op">&lt;</span><span class="ident">Example</span><span class="op">&gt;</span> <span class="op">=</span> <span class="kw">unsafe</span> { <span class="ident">Container</span>::<span class="ident">load</span>(<span class="string">&quot;libexample.dylib&quot;</span>)}.<span class="ident">unwrap</span>();
    <span class="ident">cont</span>.<span class="ident">do_something</span>();
    <span class="kw">let</span> <span class="ident">_result</span> <span class="op">=</span> <span class="kw">unsafe</span> { <span class="ident">cont</span>.<span class="ident">add_one</span>(<span class="number">5</span>) };
    <span class="kw-2">*</span><span class="ident">cont</span>.<span class="ident">global_count_mut</span>() <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
    <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;C string: {}&quot;</span>, <span class="ident">cont</span>.<span class="ident">c_string</span>().<span class="ident">to_str</span>().<span class="ident">unwrap</span>())
}</pre></div>
<p><strong>Note</strong>: <code>WrapperApi</code> should only be used together with <code>Container</code> structure, never to create
a standalone object. API and library handle need to be kept together to prevent dangling symbols.</p>
<p><strong>Note:</strong> By default obtained symbol name is the field name. You can change this by
assigning the &quot;dlopen_name&quot; attribute to the given field.</p>
<p><strong>Note:</strong> By default <code>Error::NullSymbol</code> is returned if the loaded symbol name has a null value.
While null is a valid value of a exported symbol, it is usually not expected by users of libraries.
If in your scenario null is an acceptable value, you should assign
&quot;dlopen_allow_null&quot; attribute to the given field. Of course this makes sense only if the field
is of pointer type.</p>
</div><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><h3 id="tymethod.load" class="method"><code>unsafe fn <a href="#tymethod.load" class="fnname">load</a>(lib: &amp;<a class="struct" href="../../dlopen/raw/struct.Library.html" title="struct dlopen::raw::Library">Library</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self, <a class="enum" href="../../dlopen/enum.Error.html" title="enum dlopen::Error">Error</a>&gt;</code></h3><div class="docblock"><p>Load symbols from provided library.</p>
</div></div><span class="loading-content">Loading content...</span><h2 id="foreign-impls" class="small-section-header">Implementations on Foreign Types<a href="#foreign-impls" class="anchor"></a></h2><h3 id="impl-WrapperApi-for-Option%3CT%3E" class="impl"><code class="in-band">impl&lt;T&gt; <a class="trait" href="../../dlopen/wrapper/trait.WrapperApi.html" title="trait dlopen::wrapper::WrapperApi">WrapperApi</a> for <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;T: <a class="trait" href="../../dlopen/wrapper/trait.WrapperApi.html" title="trait dlopen::wrapper::WrapperApi">WrapperApi</a>,&nbsp;</span></code><a href="#impl-WrapperApi-for-Option%3CT%3E" class="anchor"></a><a class="srclink" href="../../src/dlopen/wrapper/option.rs.html#5-15" title="goto source code">[src]</a></h3><div class="impl-items"><h4 id="method.load" class="method hidden"><code>unsafe fn <a href="#method.load" class="fnname">load</a>(lib: &amp;<a class="struct" href="../../dlopen/raw/struct.Library.html" title="struct dlopen::raw::Library">Library</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self, <a class="enum" href="../../dlopen/enum.Error.html" title="enum dlopen::Error">Error</a>&gt;</code><a class="srclink" href="../../src/dlopen/wrapper/option.rs.html#9-14" title="goto source code">[src]</a></h4></div><span class="loading-content">Loading content...</span><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><span class="loading-content">Loading content...</span><script type="text/javascript" src="../../implementors/dlopen/wrapper/trait.WrapperApi.js" async></script></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "dlopen";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>